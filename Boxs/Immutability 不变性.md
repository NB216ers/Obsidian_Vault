#java 

## Immutability 是解决并发问题的一种方式

"多个线程同时读写同一共享变量存在并发问题"，必要条件之一是 【读写】 ，如果只有读，而没有写，是没有并发问题的。

## 不变性：就是对象一旦被创建之后，状态就不再发生变化。

不可变对象被创建出来后，对象中的共享变量不在提供修改的途径，就意味着不会修改共享变量。

比如 JDK 中的基础类型包装类；String 类、Long、Double 等的线程安全都是靠不可变来保证的。[[线程安全]]

它们严格遵守：类和属性都是 final 的，所有方法均是只读的。

## 但是 String 有类似字符替换，切割的操作，这些不是修改的功能吗？怎么说是不可变的呢？

**String 对象会创建一个新的不可变对象**，所有修改操作都创建一个新的不可变对象。[[Copy-on-Write]]

## 那不可变对象是不是创建的对象太多了，有点太浪费内存了？

利用享元模式避免创建重复对象。本质上是对象池，创建之前，首先去对象池看看是不是存在，存在就利用对象池的对象；不存在就创建一个对象，并且把新对象放进对象池里。

## 内部用到享元模式的类，不适合做锁。

![[Pasted image 20230303152114.png]]