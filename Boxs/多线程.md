#java

## 多线程的好处

多线程提升程序性能。

性能度量指标：[[延迟]]、[[吞吐量]] 。提升性能就是降低延迟，提高吞吐量，一方面是优化算法，另一方面将硬件的性能发挥到极致。

多线程能提升硬件的利用率，发挥硬件的性能。硬件主要分 I/O 和 CPU, 它们之间的主要矛盾是速度的差异，CPU 的速度远远超过 I/O 的速度，在需要 CPU 和 IO 配合的单线程情况下，执行 I/O 操作时，CPU 空闲，利用率极低。操作系统已经解决了磁盘和网卡的利用率问题，利用中断机制还能避免 CPU 轮询 I/O 状态，也提升了 CPU 的利用率。但是需要 CPU 和 I/O 配合的工作，它们的综合利用率问题，操作系统提供了多线程的解决方案。

![[原子性#操作系统的分时复用即提高了 CPU 的使用率，又提高了 I/O 的使用率。]]

如果 CPU 和 I/O 设备的利用率都很低，那么可以尝试通过增加线程来提高吞吐量。

## 线程数如何定呢？
### I/O 密集型
最佳线程数 =CPU 核数*（ 1 + （I/O 耗时/CPU 耗时））
![[Pasted image 20230302171324.png]]

I/O 耗时/CPU 耗时：工具 apm
### CPU 密集型
多线程本质上是提升了多核 CPU 的利用率，线程数一般设置为 CPU 核数+1.

结论：最终还是要靠压测来确定。

## 多线程带来的问题！
多个线程同时读写同一共享变量，操作系统的分时复用，使线程切换，破环了原子性。[[原子性#什么破坏了原子性？]]
